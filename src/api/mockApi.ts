/**
 * Mock API для генерации сообщений
 * В будущем можно заменить на реальный API
 */

export interface GenerateRequest {
  platform: string;
  stage: string;
  girlInfo: string;
}

export interface GenerateResponse {
  messages: string[];
}

// Шаблоны сообщений для разных платформ и стадий
const messageTemplates: Record<string, Record<string, string[]>> = {
  tinder: {
    first: [
      'Твоя улыбка на третьем фото — это что-то. Расскажи, где это было снято?',
      'Слушай, у тебя реально крутой вкус. Давно увлекаешься [интерес]?',
      'Окей, я должен признать — я залип на твоём профиле минут на пять. Расскажи, кто ты и почему так цепляешь?',
    ],
    transition: [
      'Рад, что мы теперь тут! В Tinder вечно теряются сообщения. Так что рассказывай — чем занята на этих выходных?',
      'Ну вот, теперь можем нормально пообщаться. Кстати, ты случайно не любишь [интерес]?',
      'Отлично, перешли! Теперь давай договоримся о кофе — или ты больше за вино?',
    ],
    chatting: [
      'Знаешь, я тут подумал — мы реально похожи. Когда встретимся и проверим это вживую?',
      'Слушай, переписываться круто, но голос хочу услышать. Что скажешь про звонок?',
      'Окей, хватит текстов. Давай я забронирую столик в [место] на пятницу?',
    ],
  },
  pure: {
    first: [
      'Без лишних слов: ты реально привлекаешь. Давай познакомимся?',
      'Твой профиль — как глоток свежего воздуха. Расскажи, какая ты на самом деле?',
      'Честно? Ты первая, кому я пишу за неделю. Что-то в тебе зацепило.',
    ],
    transition: [
      'Давай продолжим здесь — так удобнее. Рассказывай, что планируешь на вечер?',
      'Pure сделал своё дело, теперь дело за нами. Какие планы?',
      'Отлично, что перешли. Так когда встретимся?',
    ],
    chatting: [
      'Слушай, химия явно есть. Может, проверим её вживую?',
      'Мне нравится, как мы общаемся. Давай переведём это в реал?',
      'Достаточно текстов. Завтра вечером свободна?',
    ],
  },
  twinby: {
    first: [
      'Привет! Увидел тебя в Twinby и понял — надо написать. Чем увлекаешься?',
      'Твой профиль прям зацепил. Расскажи немного о себе?',
      'Эй, приятно познакомиться! Что привело тебя в Twinby?',
    ],
    transition: [
      'Круто, что перешли сюда! Так удобнее. Чем занимаешься сегодня?',
      'Рад, что мы теперь в телеге. Рассказывай, какие планы?',
      'Отлично! Теперь можем нормально пообщаться. Что нового?',
    ],
    chatting: [
      'Мне реально интересно с тобой общаться. Может, встретимся?',
      'Слушай, хочется уже увидеть тебя вживую. Что думаешь?',
      'Давай как-нибудь пересечёмся? Знаю одно классное место.',
    ],
  },
  instagram: {
    first: [
      'Подписался на тебя, потому что реально зацепили твои фото. Сама снимаешь?',
      'Твоя лента — это что-то! Особенно понравилось [конкретный пост]. Расскажи подробнее?',
      'Привет! Наткнулся на твой профиль через рилс. Ты реально так классно [занятие]?',
    ],
    transition: [
      'Инста — это круто, но давай общаться здесь? Так удобнее.',
      'Переходим в личку! Расскажи, чем занимаешься помимо Instagram?',
      'Давай продолжим тут — в инсте вечно теряются сообщения.',
    ],
    chatting: [
      'Знаешь, ты реально интересный человек. Давай пересечёмся?',
      'Чувствую, что мы бы классно провели время вместе. Встретимся?',
      'Хватит лайков и текстов — давай в реале!',
    ],
  },
  real: {
    first: [
      'Привет! Это [твоё имя] — мы познакомились [где]. Рад, что ты написала!',
      'Эй, помнишь меня? Мы виделись [где]. Решил написать — давно хотел.',
      'Привет! Это тот парень из [место]. Как дела?',
    ],
    transition: [
      'Классно, что мы теперь на связи! Как прошёл день?',
      'Рад, что обменялись контактами. Рассказывай, как ты?',
      'Отлично, теперь можем нормально пообщаться! Что делаешь?',
    ],
    chatting: [
      'Слушай, мне реально нравится с тобой общаться. Давай встретимся?',
      'Помнишь, мы говорили про [тема]? Давай сходим туда вместе?',
      'Что думаешь, если встретимся на выходных?',
    ],
  },
};

// Персонализация сообщения на основе информации о девушке
const personalizeMessage = (message: string, girlInfo: string): string => {
  // Извлекаем возможные интересы из описания
  const interests = girlInfo.toLowerCase();
  
  if (interests.includes('фильм') || interests.includes('кино')) {
    message = message.replace('[интерес]', 'кино');
    message = message.replace('[занятие]', 'разбираешься в фильмах');
    message = message.replace('[место]', 'кинотеатре');
    message = message.replace('[тема]', 'фильмы');
  } else if (interests.includes('музык')) {
    message = message.replace('[интерес]', 'музыкой');
    message = message.replace('[занятие]', 'понимаешь музыку');
    message = message.replace('[место]', 'концерте');
    message = message.replace('[тема]', 'концерты');
  } else if (interests.includes('спорт') || interests.includes('фитнес')) {
    message = message.replace('[интерес]', 'спортом');
    message = message.replace('[занятие]', 'выглядишь');
    message = message.replace('[место]', 'фитнес-кафе');
    message = message.replace('[тема]', 'тренировки');
  } else if (interests.includes('путешеств')) {
    message = message.replace('[интерес]', 'путешествиями');
    message = message.replace('[занятие]', 'путешествуешь');
    message = message.replace('[место]', 'классном баре');
    message = message.replace('[тема]', 'путешествия');
  } else {
    // Дефолтные значения
    message = message.replace('[интерес]', 'этим');
    message = message.replace('[занятие]', 'выглядишь');
    message = message.replace('[место]', 'уютном кафе');
    message = message.replace('[тема]', 'наши планы');
  }
  
  // Если остались плейсхолдеры — заменяем на универсальные
  message = message.replace('[конкретный пост]', 'последний пост');
  message = message.replace('[твоё имя]', 'Я');
  message = message.replace('[где]', 'недавно');
  
  return message;
};

// Функция генерации сообщений
export const generateMessages = async (
  request: GenerateRequest
): Promise<GenerateResponse> => {
  // Эмулируем задержку API
  await new Promise((resolve) => setTimeout(resolve, 1500 + Math.random() * 1000));
  
  // Получаем шаблоны для платформы и стадии
  const platformTemplates = messageTemplates[request.platform] || messageTemplates.tinder;
  const stageTemplates = platformTemplates[request.stage] || platformTemplates.first;
  
  // Персонализируем каждое сообщение
  const messages = stageTemplates.map((template) =>
    personalizeMessage(template, request.girlInfo)
  );
  
  // Немного перемешиваем для разнообразия
  const shuffled = [...messages].sort(() => Math.random() - 0.5);
  
  return { messages: shuffled };
};
